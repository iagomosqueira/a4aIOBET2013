% Investigating the stock status of Indian Ocean Bigeye tuna using the a4a statistical catch-at-age assessment method.
% Iago Mosqueira[^contact]; Colin P. Millar[^aff]
% October 2013


[^aff]: European Commission, Joint Research Center, IPSC/Maritime Affairs Unit, FISHREG, Via E. Fermi 2749, 21027 Ispra VA, Italy
[^contact]: Contact Author: iago.mosqueira-sanchez@jrc.ec.europa.eu

```{r, setup, echo=FALSE, results='hide', message=FALSE, cache=FALSE, warnings=FALSE}
library(knitr)
opts_chunk$set(dev='pdf', fig.width=4, fig.height=4, warnings=FALSE, cache=TRUE, echo=FALSE)
options(width=50)
```

```{r, pkgs, echo=FALSE, results='hide', message=FALSE, warnings=FALSE}
library(FLa4a)
library(pander)
set.seed(1423)
```

% library(ggplotFL)
% theme_set(theme_bw())


# Introduction

A recently developed statistical catch-at-age stock assessment method, a4a, designed for evaluating the status of stocks with intermediate data quality, is applied here to Indian Ocean bigeye tuna. The method provides huge flexibility for the rapid evaluation of the effects in parameter estimates and uncertainty of different submodels for fishing mortality-at-age (the F model), CPUE catchability-at-age (the Q model), stock recruitment (the R model) and observation variance (the V model).

The model does not attempt to substitute more complex stock assessments that make use of all sources of data, including tagging, but to provide a tool for rapid exploration of the influence of different assumptions and data sources. This capability is achieved by combining a powerful optimization engine (ADMB) with an intuitive user interface using linear models as expressed in the R language. The model is implemented as part of the FLR framework [@Kell2007], and thus can make use of the available tools for estimation of reference points, projections under different scenarios, plotting and diagnostics.

# The a4a stock assessment model

The a4a assessment model is an age structured model based on the Baranov catch equation and an assumption of constant mortality rates throughout the year. The numbers in the population at age $a$ and year $y$, $N_{ay}$, are modelled in terms of the initial age structure $N_{-a_{0},y_0}$, recruitment $N_{a_0,y}$ and fishing mortality $F_{ay}$.  Natural mortality, $M_{ay}$ is assumed known.  The full  matrix of numbers at age can be written in terms of these quantities:

$$ N_{ay}  = \left\{ \begin{array}{ll} N_{a_0,y} \phantom{\exp\left\{-\displaystyle \sum_{a'=a_0}^{a-1} Z_{a',y-a'+a_0}\right\}} & a = a_0 \\ 
                                       N_{a_0,y-a+a_0} \, \exp\left\{-\displaystyle \sum_{a'=a_0}^{a-1} Z_{a',y-a'+a_0}\right\} & a > a_0 \text{ and } a - a_0 > y - y_0 \\  
                                       N_{a-y+y_0,y_0} \, \exp\left\{-\displaystyle \sum_{a'=a-y+y_0}^{a-1} Z_{a',y-a'+a_0}\right\} & a > a_0 \text{ and } a - a_0 \leq y - y_0 \end{array} \right. $$

where $Z_{ay} = F_{ay} + M_{ay}$. In the case of a plus group the numbers in the oldest age class are given by the equation above plus additional individuals coming from the previous years' cohort.

The same quantities allow the prediction of catches and it is assumed that the log of the observed catches are independently normally distributed about the log of the predicted catches

$$ \exp\{ E[ \log C_{ay} ] \} = \frac{F_{ay}}{Z_{ay}}(1 - \exp\{-Z_{ay}\}) N_{ay} $$

An additional quantity giving the catchability of a survey, $Q_{ay}$, allows us predict survey indices, and as with catches is it assumed that the log of the observed survey indices are independently normally distributed about the log of the predicted indices.  Indices may be observations of abundance at age:

$$ \exp\{ E[ \log I_{ays} ] \} = Q_{ays} N_{ay} $$

or of biomass

$$ \exp\{ E[ \log B_{ys} ] \} = \sum_a Q_{ays} N_{ay} W_{ay} $$

in which $W_{ay}$ is the stock weight at age and year. The variance of the relationships are allowed to vary by age. These equations, defined by the quantities, $N_{a_0,y}$, $N_{-a_{0},y_0}$, $F_{ay}$ and $Q_{ays}$, provide the full description of the stock.

## recruitment modelling

It is possible to provide some internal structure to the population model in the form of a stock recruit relationship in which recruits are considered to be related to previous biomass

$$ \exp\{ E[ \log N_{a_0,y} ] \} = f\left( \sum_a N_{ay} W_{ay} m_{ay} \right) $$

where $m$ is the maturity, assumed known, and $f(.)$ is a function such as the ricker or beverton and holt stock rectuit relationship.

![Simulation results for a big eye Tuna like stock with age based indices.](figures/run1.pdf "Title")

# Data

```{r, data, echo=FALSE, results='hide', message=FALSE}
load('data/bet_iotc_2011.RData')
```

The a4a stock assessment model is an age-based model, and requires a matrix of catch-at-age information that includes all fleets and areas, on a yearly time step. This is then combined with an abundance index, in this case an standardized total catch-per-unit-effort series for the Japanese longline fleet [@IOTC-2013-WPTT15-25].

## Catch-at-age

The catch-at-age dataset made available by the IOTC Secretariat \footnote{\url{http://iotc.org/files/proceedings/2013/wptt/BET_ASPMv2.zip}, 27/09/2013} was used.

```{r, nc, echo=FALSE, tidy=TRUE, fig.cap="Total catch series for Indian Ocean bigeye, 1950-2012.", fig.width=6, fig.height=3}
ggplot(data=catch(bet)/1000, aes(year, data)) + geom_point() + geom_line() + ylab("Catch (Kt)") + xlab("")
```


## CPUE index

# Model structure and assumptions

## Fixed parameters
```{r, fixed1, results='asis'}
pandoc.table(data.frame(Parameter=c('M',NA), Ages=c('0-1', '2-9'), Value=c(0.8, 0.4)), alignment='center')
```

```{r, waa, echo=FALSE, tidy=TRUE, fig.cap="Weight-at-age in catch and stock"}
ggplot(data=catch.wt(bet)[,1], aes(age, data)) + geom_line() + ylab("Weight (kg)") + xlab("age")
```

## Estimated parameters

# Model runs

## Simulation of catchability fitting

# Results

## Population trajectories

## Reference points

## Residual diagnostics

# Discussion

# Appendix I: a4a model population dynamics

# Appendix II: Code of final run

# References

